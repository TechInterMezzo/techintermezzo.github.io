!function(t){function e(e){for(var i,r,l=e[0],c=e[1],o=e[2],d=0,u=[];d<l.length;d++)r=l[d],a[r]&&u.push(a[r][0]),a[r]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);for(h&&h(e);u.length;)u.shift()();return n.push.apply(n,o||[]),s()}function s(){for(var t,e=0;e<n.length;e++){for(var s=n[e],i=!0,l=1;l<s.length;l++){var c=s[l];0!==a[c]&&(i=!1)}i&&(n.splice(e--,1),t=r(r.s=s[0]))}return t}var i={},a={0:0},n=[];function r(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=i,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(s,i,function(e){return t[e]}.bind(null,i));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var l=window.webpackJsonp=window.webpackJsonp||[],c=l.push.bind(l);l.push=e,l=l.slice();for(var o=0;o<l.length;o++)e(l[o]);var h=c;n.push([38,1]),s()}({20:function(t,e,s){},38:function(t,e,s){"use strict";s.r(e);s(20);var i=s(1),a=s(4),n=s(18),r=s(19),l=s.n(r),c=s(6),o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("section",{staticClass:"hero is-fullheight"},[s("div",{staticClass:"hero-head"},[s("div",{staticClass:"field is-grouped is-grouped-centered"},[s("p",{staticClass:"control select is-small"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.localIsoDate,expression:"localIsoDate"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.localIsoDate=e.target.multiple?s:s[0]}}},t._l(t.pastLocalDates,function(e){return s("option",{key:e.valueOf(),domProps:{value:e.toISODate()}},[t._v("\n                            "+t._s(t._f("longDate")(e))+"\n                        ")])}),0)]),t._v(" "),s("p",{staticClass:"control"},[s("input",{staticClass:"input is-small",attrs:{type:"text",readonly:""},domProps:{value:t._f("shortTime")(t.localTime)}})]),t._v(" "),s("p",{staticClass:"control"},[s("a",{staticClass:"button is-small",on:{click:t.toggle}},[s("span",{staticClass:"icon is-small"},[s("fa-icon",{attrs:{icon:t.isPaused?"play":"pause"}})],1)])])]),t._v(" "),s("div",{staticClass:"edge is-right is-top"},[t.isLive?s("span",{staticClass:"tag is-danger"},[t._v("LIVE")]):t._e()]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.secondsOfDay,expression:"secondsOfDay"}],staticClass:"slider is-link is-fullwidth",attrs:{type:"range",step:"1",min:"0",max:"86400"},domProps:{value:t.secondsOfDay},on:{mousedown:t.beginSync,mouseup:t.endSync,__r:function(e){t.secondsOfDay=e.target.value}}})]),t._v(" "),s("div",{staticClass:"hero-body is-relative"},[s("div",{staticClass:"players"},t._l(t.selectedStreamers,function(e){return s("player",{key:e.id,attrs:{"is-paused":t.isPaused,"is-syncing":t.isSyncing,"is-live":t.isLive,now:t.now,offset:t.offset,time:t.time,"unmute-id":t.unmuteId,streamer:e,vod:t.activeVodMap[e.id]},on:{sync:t.onSync}})}),1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isSyncing,expression:"isSyncing"}],staticClass:"sync is-overlay"})])]),t._v(" "),s("section",{staticClass:"sidebar is-right has-scrollbar"},[s("div",{staticClass:"filter buttons are-small"},t._l(t.tags,function(e){return s("a",{key:e,staticClass:"button",class:[t.isFilter(e)?"is-link":"is-dark"],on:{click:function(s){return t.toggleFilter(e)}}},[t._v(t._s(e))])}),0),t._v(" "),t._l(t.filteredStreamers,function(e){return s("entry",{key:e.id,attrs:{"is-live":t.isLive,time:t.time,streamer:e,vod:t.activeVodMap[e.id],"is-selected":t.isSelected(e.id)},on:{toggle:function(s){return t.toggleSelection(e.id)}}})})],2)])};o._withStripped=!0;var h=s(2),d=s(8),u=s.n(d),y=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"entry",class:{"is-selected":t.isSelected}},[s("figure",{staticClass:"image is-clickable",on:{click:t.toggle}},[s("img",{staticClass:"is-rounded",attrs:{src:t.streamer.profileImage}})]),t._v(" "),s("span",{staticClass:"edge is-left is-top is-size-6 is-clickable",on:{click:t.toggle}},[t._v(t._s(t.streamer.name))]),t._v(" "),s("span",{staticClass:"edge is-left is-bottom is-size-7 is-clickable",on:{click:t.toggle}},[t._v(t._s(t.streamer.alias))]),t._v(" "),s("div",{staticClass:"edge is-right is-top"},[s("div",{staticClass:"tags"},t._l(t.streamer.tags,function(e){return s("span",{key:e,staticClass:"tag is-link is-rounded"},[t._v(t._s(t._f("shortTag")(e)))])}),0),t._v(" "),s("a",{staticClass:"button is-dark is-small",attrs:{target:"_blank",href:t.vodLink}},[s("fa-icon",{attrs:{icon:"external-link-alt"}})],1)])])};y._withStripped=!0;var m={props:{isLive:!1,time:{},streamer:{},vod:{},isSelected:!1},computed:{vodLink(){if(this.isLive)return"https://www.twitch.tv/"+this.streamer.name.toLowerCase();let t=this.time.diff(this.vod.beginAt).toFormat("hh'h'mm'm'ss's'");return`https://www.twitch.tv/videos/${this.vod.id}?t=${t}`}},filters:{shortTag:t=>t.replace(/[^A-Z]+/g,"")},methods:{toggle(){this.$emit("toggle")}}},f=s(3),v=Object(f.a)(m,y,[],!1,null,null,null);v.options.__file="src/entry.vue";var p=v.exports,g=function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"player",attrs:{id:"player-"+this.streamer.id}})};g._withStripped=!0;s(7);var S={props:{isPaused:!1,isSyncing:!1,isLive:!1,now:{},offset:0,time:{},unmuteId:"",streamer:{},vod:{}},data:()=>({isPlayerReady:!1,state:{isPaused:!1,isLive:!1,isMuted:!1,vodId:"",vodOffset:0}}),created(){this.stateInterval=window.setInterval(this.updateState,200),this.syncCount=0,this.syncCallback=null,this.syncState={isPaused:!1,isLive:!1,isMuted:!1,vodId:"",vodOffset:0}},mounted(){this.beginSync(),this.player=new Twitch.Player("player-"+this.streamer.id,{width:"100%",height:"100%"}),this.player.addEventListener(Twitch.Player.READY,()=>{this.isPlayerReady=!0,this.syncPlayerMute(!0),this.endSync()})},beforeDestroy(){window.clearInterval(this.stateInterval),this.cancelSync()},computed:{vodOffset(){return this.isLive?0:this.time.diff(this.vod.beginAt).valueOf()},stateTime(){return this.isLive?this.now:this.vod.beginAt.plus(this.state.vodOffset)},isTimeSynced(){return!!this.isPaused||this.state.isLive==this.isLive&&(this.isLive||Math.abs(this.time.diff(this.stateTime).valueOf())<=3e3)}},watch:{unmuteId(t){t!=this.streamer.id&&this.syncPlayerMute(!0)},isPaused(t){t?this.isSyncing||this.syncPlayerPause(!0):this.startPlayerTimeSync()},isLive(){this.startPlayerTimeSync()},isSyncing(t){t?this.syncPlayerMute(!0):this.unmuteId==this.streamer.id&&this.syncPlayerMute(!1),this.startPlayerTimeSync()},offset(){this.startPlayerTimeSync()},vod(){this.startPlayerTimeSync()}},methods:{updateState(){this.isPlayerReady&&(this.state.isLive=!!this.player.getChannel(),this.state.isMuted=this.player.getMuted(),this.state.vodId=(this.player.getVideo()||"v").substr(1),this.state.isPaused=!this.state.isLive&&!this.state.vodId||this.player.isPaused()||this.player.getEnded(),this.state.isLive?this.state.vodOffset=0:this.state.isPaused?this.state.vodOffset=this.state.vodOffset:this.state.vodOffset=Math.floor(1e3*this.player.getCurrentTime()),this.syncPlayer())},syncPlayer(){this.isSyncing?this.syncCallback?this.checkTimeSync():this.syncCount||this.syncState.isPaused||!this.isTimeSynced||this.syncPlayerPause(!0):this.state.isPaused!=this.syncState.isPaused?this.syncAppPause():this.state.isMuted!=this.syncState.isMuted?this.syncAppMute():this.isTimeSynced?!this.isPaused&&this.syncState.isPaused&&this.syncPlayerPause(!1):this.startAppTimeSync()},syncPlayerPause(t){this.isPlayerReady&&(t?this.syncState.isPaused||(this.player.pause(),this.syncState.isPaused=!0):this.syncState.isPaused&&(this.player.play(),this.syncState.isPaused=!1))},syncPlayerMute(t){this.isPlayerReady&&t!=this.syncState.isMuted&&(this.player.setMuted(t),this.syncState.isMuted=t)},syncPlayerTime(){this.isPlayerReady&&(this.syncPlayerPause(!1),this.isLive?this.syncState.isLive||(this.player.setChannel(this.streamer.name.toLowerCase()),this.player.setLiveLowLatencyEnabled(!1),this.syncState.isLive=!0):this.syncState.vodId!=this.vod.id?(this.player.setVideo("v"+this.vod.id,this.vodOffset/1e3),this.syncState.vodId=this.vod.id,this.syncState.vodOffset=this.vodOffset):Math.abs(this.syncState.vodOffset-this.vodOffset)>3e3&&(this.player.seek(this.vodOffset/1e3),this.syncState.vodOffset=this.vodOffset))},syncAppPause(){this.$emit("sync","pause",this.state.isPaused),this.syncState.isPaused=this.state.isPaused},syncAppMute(){this.state.isMuted||this.$emit("sync","unmute",this.streamer.id),this.syncState.isMuted=this.state.isMuted},syncAppTime(){this.$emit("sync","time",this.stateTime),this.syncState.isLive=this.state.isLive,this.syncState.vodId=this.state.vodId,this.syncState.vodOffset=this.state.vodOffset},startPlayerTimeSync(){this.startTimeSync(this.syncPlayerTime)},startAppTimeSync(){this.startTimeSync(this.syncAppTime)},startTimeSync(t){this.isPaused||this.isSyncing||this.syncCallback||this.isTimeSynced||(this.beginSync(),this.syncCallback=t,this.checkTimeSync())},checkTimeSync(){this.syncCallback&&(this.isTimeSynced?this.stopSync():this.syncCallback())},stopSync(){this.syncCallback&&(this.syncCallback=null,this.endSync())},beginSync(){this.syncCount++,this.$emit("sync","begin")},endSync(){this.$emit("sync","end"),this.syncCount--},cancelSync(){this.$emit("sync","cancel",this.syncCount),this.syncCount=0}}},P=Object(f.a)(S,g,[],!1,null,null,null);P.options.__file="src/player.vue";var b=P.exports;const C=h.DateTime.utc(2e3,1,1,0,0,0,0);var T={data:()=>({isPaused:!1,syncCount:0,now:h.DateTime.utc(),offset:0,unmuteId:"",streamers:[],vodsMap:{},selections:[],filters:[]}),created(){this.timestampMap={};let t=u.a.get("time");t&&(this.beginSync(),this.time=h.DateTime.fromISO(t),this.updateNow(),this.endSync())},beforeMount(){setInterval(this.updateNow,1e3),setInterval(this.updateStreamers,6e4)},computed:{isSyncing(){return this.syncCount>0},isLive(){return this.offset<=6e4},time:{get(){return this.now.minus(this.offset)},set(t){let e=this.now.diff(t.toUTC()).valueOf();this.offset=e>6e4?e:0}},timeCycle(){return Math.floor(this.time.diff(C).valueOf()/864e5*3)},localToday(){return this.now.toLocal().startOf("day")},localTime:{get(){return this.time.toLocal()},set(t){this.time=t.toUTC()}},localDate(){return this.localTime.startOf("day")},localIsoDate:{get(){return this.localDate.toISODate()},set(t){this.localTime=h.DateTime.fromISO(t).plus(this.localTime.diff(this.localDate))}},pastLocalDates(){let t=[];for(let e=13;e>=0;e--)t.push(this.localToday.minus(24*e*60*60*1e3));return t},secondsOfDay:{get(){return Math.floor(this.localTime.diff(this.localDate).valueOf()/1e3)},set(t){this.localTime=this.localDate.plus(1e3*t)}},activeStreamers(){return this.isLive?this.streamers.filter(t=>t.isLive&&"32982"==t.gameId):this.streamers.filter(t=>t.id in this.activeVodMap)},filteredStreamers(){return 0==this.filters.length?this.activeStreamers:this.activeStreamers.filter(t=>this.filters.every(e=>t.tags.includes(e)))},selectedStreamers(){return this.activeStreamers.filter(t=>this.isSelected(t.id)).slice(0,4)},activeVodMap(){let t={};for(let e of this.streamers)if(this.isActiveStreamer(e)){let s=this.vodsMap[e.id]||[];for(let i in s){let a=s[i],n=e.isLive&&i==s.length-1&&+a.endAt==+a.beginAt;if(a.beginAt<=this.time&&(n||a.endAt>=this.time)){t[e.id]=a;break}}}return t},tags(){return this.streamers.map(t=>t.tags).flat().filter((t,e,s)=>s.indexOf(t)===e)}},watch:{isLive(t){t||this.updateVods()},timeCycle(){this.updateVods()},streamers(){this.updateVods()}},filters:{longDate:t=>t.toLocaleString(h.DateTime.DATE_HUGE),shortTime:t=>t.toLocaleString(h.DateTime.TIME_WITH_SECONDS)},methods:{toggle(){this.isPaused=!this.isPaused},updateNow(){let t=this.now;this.now=h.DateTime.utc(),this.isPaused||this.isSyncing?this.offset=this.now.diff(t.minus(this.offset)).valueOf():u.a.set("time",this.isLive?"":this.time.toISO(),{expires:30,path:""})},async updateStreamers(){let t=await this.client.getStreamers();t&&(this.streamers=t)},async updateVods(){for(let t of this.streamers)if(this.isActiveStreamer(t)&&t.endedAt!=this.timestampMap[t.id]){this.timestampMap[t.id]=t.endedAt;let e=await this.client.getVods(t.id)||[];this.vodsMap[t.id]=e.map(t=>(t.beginAt=h.DateTime.fromISO(t.beginAt).toUTC(),t.endAt=h.DateTime.fromISO(t.endAt).toUTC(),t))}},isActiveStreamer(t){return t.activeTimeCycles.includes(this.timeCycle)||t.activeTimeCycles.includes(this.timeCycle-1)||t.activeTimeCycles.includes(this.timeCycle-2)||t.activeTimeCycles.includes(this.timeCycle+1)||t.activeTimeCycles.includes(this.timeCycle+2)},getActiveVod(t){return this.activeVodMap[t]},isFilter(t){return this.filters.includes(t)},toggleFilter(t){let e=this.filters.indexOf(t);e>=0?this.filters.splice(e,1):this.filters.push(t)},isSelected(t){return this.selections.includes(t)},toggleSelection(t){let e=this.selections.indexOf(t);e>=0?this.selections.splice(e,1):this.selections.push(t)},beginSync(){this.syncCount++},endSync(t){this.syncCount--},cancelSync(t){this.syncCount-=t},onSync(t,e){switch(t){case"begin":this.beginSync();break;case"end":this.endSync();break;case"cancel":this.cancelSync(e);break;case"pause":this.isPaused=e;break;case"unmute":this.unmuteId=e;break;case"time":this.time=e}}},components:{Entry:p,Player:b}},_=Object(f.a)(T,o,[],!1,null,null,null);_.options.__file="src/app.vue";var w=_.exports;i.c.add(a.c),i.c.add(a.b),i.c.add(a.a),i.c.add(a.d),i.c.add(a.e),c.a.component("fa-icon",n.a),c.a.config.productionTip=!1;var O=new c.a(w);O.client=new class{constructor(){this.http=l.a.create({baseURL:"/data/gtarpsync",validateStatus:t=>200==t||304==t}),this.etag=""}async getStreamers(){let t=await this.http.get("index.json",{headers:{"If-None-Match":this.etag}});return this.etag=t.headers.etag,200==t.status?t.data.streamers:null}async getVods(t){let e=await this.http.get(`vods/${t}.json`);return 200==e.status?e.data:null}},O.updateStreamers(),O.$mount("app")}});