!function(t){function e(e){for(var s,r,l=e[0],c=e[1],o=e[2],d=0,u=[];d<l.length;d++)r=l[d],a[r]&&u.push(a[r][0]),a[r]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(t[s]=c[s]);for(h&&h(e);u.length;)u.shift()();return n.push.apply(n,o||[]),i()}function i(){for(var t,e=0;e<n.length;e++){for(var i=n[e],s=!0,l=1;l<i.length;l++){var c=i[l];0!==a[c]&&(s=!1)}s&&(n.splice(e--,1),t=r(r.s=i[0]))}return t}var s={},a={0:0},n=[];function r(e){if(s[e])return s[e].exports;var i=s[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=s,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(i,s,function(e){return t[e]}.bind(null,s));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var l=window.webpackJsonp=window.webpackJsonp||[],c=l.push.bind(l);l.push=e,l=l.slice();for(var o=0;o<l.length;o++)e(l[o]);var h=c;n.push([37,1]),i()}({19:function(t,e,i){},37:function(t,e,i){"use strict";i.r(e);i(19);var s=i(1),a=i(4),n=i(17),r=i(18),l=i.n(r),c=i(6),o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("section",{staticClass:"hero is-fullheight"},[i("div",{staticClass:"hero-head"},[i("div",{staticClass:"field is-grouped is-grouped-centered"},[i("p",{staticClass:"control select is-small"},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.localIsoDate,expression:"localIsoDate"}],on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.localIsoDate=e.target.multiple?i:i[0]}}},t._l(t.pastLocalDates,function(e){return i("option",{key:e.valueOf(),domProps:{value:e.toISODate()}},[t._v("\n                            "+t._s(t._f("longDate")(e))+"\n                        ")])}),0)]),t._v(" "),i("p",{staticClass:"control"},[i("input",{staticClass:"input is-small",attrs:{type:"text",readonly:""},domProps:{value:t._f("shortTime")(t.localTime)}})]),t._v(" "),i("p",{staticClass:"control"},[i("a",{staticClass:"button is-small",on:{click:t.toggle}},[i("span",{staticClass:"icon is-small"},[i("fa-icon",{attrs:{icon:t.isRunning?"pause":"play"}})],1)])])]),t._v(" "),i("div",{staticClass:"edge is-right is-top"},[t.isLive?i("span",{staticClass:"tag is-danger"},[t._v("LIVE")]):t._e()]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.secondsOfDay,expression:"secondsOfDay"}],staticClass:"slider is-link is-fullwidth",attrs:{type:"range",step:"1",min:"0",max:"86400"},domProps:{value:t.secondsOfDay},on:{mousedown:t.beginSync,mouseup:t.endSync,__r:function(e){t.secondsOfDay=e.target.value}}})]),t._v(" "),i("div",{staticClass:"hero-body is-relative"},t._l(t.selectedStreamers,function(e){return i("player",{key:e.id,attrs:{"is-running":t.isRunning,"is-syncing":t.isSyncing,"is-live":t.isLive,now:t.now,time:t.time,streamer:e,vod:t.activeVodMap[e.id]},on:{sync:t.onSync}})}),1)]),t._v(" "),i("section",{staticClass:"sidebar is-right has-scrollbar"},[i("div",{staticClass:"filter buttons are-small"},t._l(t.tags,function(e){return i("a",{key:e,staticClass:"button",class:[t.isFilter(e)?"is-link":"is-dark"],on:{click:function(i){return t.toggleFilter(e)}}},[t._v(t._s(e))])}),0),t._v(" "),t._l(t.filteredStreamers,function(e){return i("entry",{key:e.id,attrs:{"is-live":t.isLive,time:t.time,streamer:e,vod:t.activeVodMap[e.id],"is-selected":t.isSelected(e.id)},on:{toggle:function(i){return t.toggleSelection(e.id)}}})})],2)])};o._withStripped=!0;var h=i(2),d=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"entry",class:{"is-selected":t.isSelected}},[i("figure",{staticClass:"image is-clickable",on:{click:t.toggle}},[i("img",{staticClass:"is-rounded",attrs:{src:t.streamer.profileImage}})]),t._v(" "),i("span",{staticClass:"edge is-left is-top is-size-6 is-clickable",on:{click:t.toggle}},[t._v(t._s(t.streamer.name))]),t._v(" "),i("span",{staticClass:"edge is-left is-bottom is-size-7 is-clickable",on:{click:t.toggle}},[t._v(t._s(t.streamer.alias))]),t._v(" "),i("div",{staticClass:"edge is-right is-top"},[i("div",{staticClass:"tags"},t._l(t.streamer.tags,function(e){return i("span",{key:e,staticClass:"tag is-link is-rounded"},[t._v(t._s(t._f("shortTag")(e)))])}),0),t._v(" "),i("a",{staticClass:"button is-dark is-small",attrs:{target:"_blank",href:t.vodLink}},[i("fa-icon",{attrs:{icon:"external-link-alt"}})],1)])])};d._withStripped=!0;var u={props:{isLive:!1,time:{},streamer:{},vod:{},isSelected:!1},computed:{vodLink(){if(this.isLive)return"https://www.twitch.tv/"+this.streamer.name.toLowerCase();let t=this.time.diff(this.vod.beginAt).toFormat("hh'h'mm'm'ss's'");return`https://www.twitch.tv/videos/${this.vod.id}?t=${t}`}},filters:{shortTag:t=>t.replace(/[^A-Z]+/g,"")},methods:{toggle(){this.$emit("toggle")}}},y=i(3),p=Object(y.a)(u,d,[],!1,null,null,null);p.options.__file="src/entry.vue";var f=p.exports,g=function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"player",attrs:{id:"player-"+this.streamer.id}})};g._withStripped=!0;i(7);var v={props:{isRunning:!1,isSyncing:!1,isLive:!1,now:{},time:{},streamer:{},vod:{}},data:()=>({isPlayerLive:!0,isPlayerRunning:!0,playerOffset:0}),created(){this.isReady=!1,this.syncTarget=null,this.syncInterval=null},mounted(){this.beginSync(),this.player=new Twitch.Player("player-"+this.streamer.id,{width:"100%",height:"100%"}),this.player.addEventListener(Twitch.Player.PLAYING,this.onPlaying),this.player.addEventListener(Twitch.Player.PLAY,this.onPlay),this.player.addEventListener(Twitch.Player.PAUSE,this.onPause),this.player.addEventListener(Twitch.Player.READY,this.onReady)},beforeDestroy(){this.endSync()},computed:{offset(){return this.isLive?0:Math.floor(this.time.diff(this.vod.beginAt).valueOf()/1e3)},playerTime(){return this.isLive?this.now:this.vod.beginAt.plus(1e3*this.playerOffset)},isSync(){return this.isPlayerLive==this.isLive&&this.isPlayerRunning==this.isRunning&&(!!this.isLive||Math.abs(this.time.diff(this.playerTime).valueOf())<=3e3)}},watch:{now(){this.updatePlayerData()},isSyncing(t){t||this.stopSync()},isRunning(){this.isSyncing||this.$nextTick(this.startPlayerSync)},isLive(){this.isSyncing||this.$nextTick(this.startPlayerSync)},offset(){this.isSyncing||this.$nextTick(this.startPlayerSync)},playerOffset(){this.isSyncing||this.$nextTick(this.startPlayerSync)},vod(){this.isSyncing||this.$nextTick(this.startPlayerSync)}},methods:{updatePlayerData(){this.isReady&&(this.isPlayerLive=!!this.player.getChannel(),this.isPlayerRunning=!this.player.isPaused(),this.isPlayerLive?this.playerOffset=0:this.player.isPaused()||(this.playerOffset=Math.floor(this.player.getCurrentTime())))},startPlayerSync(){this.startSync("player",()=>this.syncPlayer())},startAppSync(t,e){this.startSync("app",()=>this.$emit("sync",t,e))},startSync(t,e){!this.isReady||this.syncTarget||this.isSync||(this.syncTarget=t,this.beginSync(),this.checkSync(e),this.syncInterval=window.setInterval(()=>this.checkSync(e),500))},checkSync(t){this.isReady&&this.syncTarget&&(this.isSync?this.stopSync():t())},stopSync(){this.syncTarget&&(window.clearInterval(this.syncInterval),this.syncInterval=null,this.syncTarget=null,this.endSync())},beginSync(){this.$emit("sync","begin")},endSync(){this.$emit("sync","end")},syncPlayer(){if(this.isReady){if(this.isLive){let t=this.streamer.name.toLowerCase();this.player.getChannel()!=t&&this.player.setChannel(t)}else{let t="v"+this.vod.id;this.player.getVideo()!=t&&this.player.setVideo(t,this.offset),this.isSync||this.player.seek(this.offset)}this.isRunning&&!this.isPlayerRunning?this.player.play():!this.isRunning&&this.isPlayerRunning&&this.player.pause()}},onPlaying(){if(this.isSyncing||this.isLive)this.updatePlayerData();else{this.beginSync(),this.updatePlayerData();let t=this.playerOffset,e=window.setInterval(()=>{this.updatePlayerData(),this.playerOffset!=t&&(window.clearInterval(e),this.startAppSync("playing",this.playerTime),this.endSync())},200)}},onPlay(){if(this.isSyncing)this.updatePlayerData();else{this.beginSync(),this.updatePlayerData();let t=window.setInterval(()=>{this.updatePlayerData(),this.isPlayerRunning&&(window.clearInterval(t),this.startAppSync("play"),this.endSync())},200)}},onPause(){if(this.isSyncing)this.updatePlayerData();else{this.beginSync(),this.updatePlayerData();let t=window.setInterval(()=>{this.updatePlayerData(),this.isPlayerRunning||(window.clearInterval(t),this.startAppSync("pause"),this.endSync())},200)}},onReady(){this.isReady=!0,this.isRunning&&(this.updatePlayerData(),this.startPlayerSync()),this.endSync()}}},m=Object(y.a)(v,g,[],!1,null,null,null);m.options.__file="src/player.vue";var S=m.exports;const w=h.DateTime.utc(2e3,1,1,0,0,0,0);var b={data:()=>({isRunning:!0,syncCount:0,now:h.DateTime.utc(),offset:0,streamers:[],vodsMap:{},selections:[],filters:[]}),created(){this.timestampMap={}},beforeMount(){setInterval(this.updateNow,1e3),setInterval(this.updateStreamers,6e4)},computed:{isSyncing(){return this.syncCount>0},isTicking(){return this.isRunning&&!this.isSyncing},isLive(){return this.offset<=6e4},time:{get(){return this.now.minus(this.offset)},set(t){let e=this.now.diff(t.toUTC()).valueOf();this.offset=e>6e4?e:0}},timeCycle(){return Math.floor(this.time.diff(w).valueOf()/864e5*3)},localToday(){return this.now.toLocal().startOf("day")},localTime:{get(){return this.time.toLocal()},set(t){this.time=t.toUTC()}},localDate(){return this.localTime.startOf("day")},localIsoDate:{get(){return this.localDate.toISODate()},set(t){this.localTime=h.DateTime.fromISO(t).plus(this.localTime.diff(this.localDate))}},pastLocalDates(){let t=[];for(let e=13;e>=0;e--)t.push(this.localToday.minus(24*e*60*60*1e3));return t},secondsOfDay:{get(){return Math.floor(this.localTime.diff(this.localDate).valueOf()/1e3)},set(t){this.localTime=this.localDate.plus(1e3*t)}},activeStreamers(){return this.isLive?this.streamers.filter(t=>t.isLive):this.streamers.filter(t=>t.id in this.activeVodMap)},filteredStreamers(){return 0==this.filters.length?this.activeStreamers:this.activeStreamers.filter(t=>this.filters.every(e=>t.tags.includes(e)))},selectedStreamers(){return this.activeStreamers.filter(t=>this.isSelected(t.id)).slice(0,4)},activeVodMap(){let t={};for(let e of this.streamers)if(e.activeTimeCycles.includes(this.timeCycle)){let i=this.vodsMap[e.id]||[];for(let s of i)if(s.beginAt<=this.time&&(e.isLive&&+s.endAt==+s.beginAt||s.endAt>=this.time)){t[e.id]=s;break}}return t},tags(){return this.streamers.map(t=>t.tags).flat().filter((t,e,i)=>i.indexOf(t)===e)}},watch:{isRunning(t){t||this.cancelSync()},isLive(t){t||this.updateVods()},timeCycle(){this.updateVods()},streamers(){this.updateVods()}},filters:{longDate:t=>t.toLocaleString(h.DateTime.DATE_HUGE),shortTime:t=>t.toLocaleString(h.DateTime.TIME_WITH_SECONDS)},methods:{toggle(){this.isRunning=!this.isRunning},updateNow(){let t=this.now;this.now=h.DateTime.utc(),this.isTicking||(this.offset=this.now.diff(t.minus(this.offset)).valueOf())},async updateStreamers(){let t=await this.client.getStreamers();t&&(this.streamers=t)},async updateVods(){for(let t of this.streamers){if((t.activeTimeCycles.includes(this.timeCycle)||t.activeTimeCycles.includes(this.timeCycle-1)||t.activeTimeCycles.includes(this.timeCycle-2)||t.activeTimeCycles.includes(this.timeCycle+1)||t.activeTimeCycles.includes(this.timeCycle+2))&&t.endedAt!=this.timestampMap[t.id]){this.timestampMap[t.id]=t.endedAt;let e=await this.client.getVods(t.id)||[];this.vodsMap[t.id]=e.map(t=>(t.beginAt=h.DateTime.fromISO(t.beginAt).toUTC(),t.endAt=h.DateTime.fromISO(t.endAt).toUTC(),t))}}},isFilter(t){return this.filters.includes(t)},toggleFilter(t){let e=this.filters.indexOf(t);e>=0?this.filters.splice(e,1):this.filters.push(t)},getActiveVod(t){return this.activeVodMap[t]},isSelected(t){return this.selections.includes(t)},toggleSelection(t){let e=this.selections.indexOf(t);e>=0?this.selections.splice(e,1):this.selections.push(t)},beginSync(){this.syncCount++},endSync(){this.syncCount--},cancelSync(){this.syncCount=0},onSync(t,e){switch(t){case"begin":this.beginSync();break;case"end":this.endSync();break;case"playing":this.isRunning=!0,this.time=e;break;case"play":this.isRunning=!0;break;case"pause":this.isRunning=!1}}},components:{Entry:f,Player:S}},_=Object(y.a)(b,o,[],!1,null,null,null);_.options.__file="src/app.vue";var T=_.exports;s.c.add(a.c),s.c.add(a.b),s.c.add(a.a),s.c.add(a.d),s.c.add(a.e),c.a.component("fa-icon",n.a),c.a.config.productionTip=!1;var P=new c.a(T);P.client=new class{constructor(){this.http=l.a.create({baseURL:"/data/gtarpsync",validateStatus:t=>200==t||304==t}),this.etag=""}async getStreamers(){let t=await this.http.get("index.json",{headers:{"If-None-Match":this.etag}});return this.etag=t.headers.etag,200==t.status?t.data.streamers:null}async getVods(t){let e=await this.http.get(`vods/${t}.json`);return 200==e.status?e.data:null}},P.updateStreamers(),P.$mount("app")}});